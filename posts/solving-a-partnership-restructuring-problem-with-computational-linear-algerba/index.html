<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Solving a partnership restructuring problem with Markov processes.</title>
<meta name=description content="Daniel Furman's Portfolio and Blog">
<meta name=author content="Daniel Furman">
<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css integrity=sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2 crossorigin=anonymous>
<link rel=stylesheet href=/sass/researcher.min.css>
<link rel=icon type=image/ico href=https://daniel-furman.github.io/favicon.ico>
</head>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})})</script>
<body><div class="container mt-5">
<nav class="navbar navbar-expand-sm flex-column flex-sm-row text-nowrap p-0">
<a class="navbar-brand mx-0 mr-sm-auto" href=https://daniel-furman.github.io/>
Daniel Furman
</a>
<div class="navbar-nav flex-row flex-wrap justify-content-center">
<a class="nav-item nav-link" href=/>
About
</a>
<span class="nav-item navbar-text mx-1">/</span>
<a class="nav-item nav-link" href=/posts>
Posts
</a>
<span class="nav-item navbar-text mx-1">/</span>
<a class="nav-item nav-link" href=/bookshelf>
Bookshelf
</a>
<span class="nav-item navbar-text mx-1">/</span>
<a class="nav-item nav-link" href=/contact>
Contact
</a>
</div>
</nav>
</div>
<hr>
<div id=content>
<div class=container>
<h2 id=solving-a-partnership-restructuring-problem-with-markov-processes>Solving a partnership restructuring problem with Markov processes.</h2>
<hr>
<h3 id=intro>Intro</h3>
<p>Consider a partnership restructuring its assets into majority ownerships among N partners, who originally shared M assets (debt + value) at uneven percentages reflecting each partner's unique stake in the business. I aimed to re-distribute the assets without altering the partnership distribution, minimizing restructuring taxes levied if the stake structure changed significantly.</p>
<p>In application, I used a Markov model to exhaustively search for solutions to a three partner/eleven asset case, testing over 200 million potential restructuring states. The optimal solution incurred a 2.9mm cumulative stake change against 159mm in total business assets, an acceptably small magnitude of change (&lt;2%) that allows the client to effectively avoid significant restructuring taxes.</p>
<h3 id=markov-algorithm>Markov Algorithm</h3>
<p>We can explore the restructuring possibilities by turning the problem into a system of matrix operations and permuting across majority ownership scenarios. First, create an NxM matrix encoding the restructured shares; for example, partner N1 gets 100% of asset M1, 0% of asset M2, and so on. Each row represents a partner, each column represents an asset. As expected, each column must sum to one, hence the matrix is a probability matrix. If we think of each new structuring as a state, we are very much in the realm of <a href=https://en.wikipedia.org/wiki/Markov_decision_process>Markov processes</a>. We then multiply the NxM probability matrix with an Mx2 matrix encoding each of the assets' values and the debts. Subtract the result from the current ownership shares (a Nx2 matrix), making sure that the rows match up to the correct partner rows in the original probability matrix. Finally, we take the absolute values and sum the entries. Our result encodes the cumulative difference between the restructured partnership and the original one. The for loop then iterates through all possible permutations of the column indices, recording the cumulative stake change for the M! potential restructurings. The best restructuring occurs at the minimum stake change, which may turn up more than once, if permutation states repeat.</p>
<p><br><br>
<div><span class=math>\(sum(abs(\left[\begin{array}{cccccc}1 & 0 & 0 & 1 & 0 & 0 \\0 & 1 & 0 & 0 & 1 & 0\\0 & 0 & 1 & 0 & 0 & 1\end{array}\right]\left[\begin{array}{cc}val_1 & debt_1 \\val_2 & debt_2 \\val_3 & debt_3 \\val_4 & debt_4 \\val_5 & debt_5 \\val_6 & debt_6\end{array}\right]-\left[\begin{array}{cc}N_{1val} & N_{1debt}  \\N_{2val} & N_{2debt} \\N_{3val} & N_{3debt}\end{array}\right]))\)</span></div>
<br>
<strong>Figure 1</strong>. System of matrix operations for a partnership with 6 assets and 3 partners. The first matrix is the probability Markov matrix, the second is the values/debts of each asset, and the third is the partner's total current ownership values/debts.<br>
<br><br></p>
<h3 id=model-flexibility>Model Flexibility</h3>
<p>Why was optimal in quotes above? Well, after all that, our result may turn out to be, well, not so "optimal". Consider a simplified case: two partners evenly share three assets, but the assets are all equivalent, and, therefore, there is no way to split up the assets into majority stake ownerships. Due to this feature, I ran our Markov model across several majority ownership split scenarios, changing the total number of assets each partner is allowed to recieve. For example, in our real-world case, the optimal state was found by giving 4 properties to partner 1, 3 to partner 2, and 4 to partner 3, which was the fifth scenario tested.</p>
<p>The Markov model approach is by nature a brute force method, as we are testing across a huge number of possible scenarios. The for loops decompose to a <a href=http://web.mit.edu/16.070/www/lecture/big_o.pdf>O(n) time complexity</a>, yet the runtime can become large becuase we we are looping over M! states. For example, if we have eleven assets (11! ~40 mill states), the runtime is approximately ten minutes on CPU.</p>
<p><span class=math>\[runtime \propto n^{0.966}\]</span></p>
<p align=center> <img src=/posts/assets-runtime.png / width=550 height=366> </p>
<p><strong>Figure 2</strong>. Run-time complexity analysis for the restructuring algorithm (in log/log space). The power law relationship exhibits a n ~ 0.996 slope, indicating the linearity in the algorithm's time complexity (i.e., O(n)).
<br><br></p>
<h3 id=code>Code</h3>
<hr>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1>### Libraries ###</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=kn>from</span> <span class=nn>sympy.utilities.iterables</span> <span class=kn>import</span> <span class=n>multiset_permutations</span>
<span class=kn>import</span> <span class=nn>time</span>

<span class=c1>### Data I/O ###</span>
<span class=n>restructure_probabilities</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>genfromtext</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=c1># probability matrix</span>
<span class=n>assets_value_debt</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>genfromtext</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=c1># asset value/debt df</span>
<span class=n>previous_stake</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>genfromtext</span><span class=p>(</span><span class=o>...</span><span class=p>)</span> <span class=c1># previous asset value/debt df</span>
<span class=n>num_assets</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>assets_value_debt</span><span class=p>[:,</span><span class=mi>0</span><span class=p>])</span> <span class=c1># num of assets to restructure, M</span>
<span class=n>n_factorial</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>math</span><span class=o>.</span><span class=n>factorial</span><span class=p>(</span><span class=n>num_assets</span><span class=p>)</span> <span class=c1># num of scenarios, M!</span>

<span class=c1>### Algorithm ###</span>
<span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<span class=n>permutations</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_factorial</span><span class=p>,</span> <span class=n>num_assets</span><span class=p>))</span> 
<span class=n>index</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>num_assets</span><span class=p>)</span> 
<span class=nb>iter</span> <span class=o>=</span> <span class=mi>0</span>
<span class=c1># store all M permutations</span>
<span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>multiset_permutations</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
    <span class=n>permutations</span><span class=p>[</span><span class=nb>iter</span><span class=p>,:]</span> <span class=o>=</span> <span class=n>p</span> 
    <span class=nb>iter</span><span class=o>+=</span><span class=mi>1</span>
<span class=n>permutations</span> <span class=o>=</span> <span class=n>permutations</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
<span class=n>results</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n_factorial</span><span class=p>)</span> 
<span class=k>for</span> <span class=nb>iter</span> <span class=ow>in</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n_factorial</span><span class=p>):</span>
  <span class=c1># shuffle columns</span>
  <span class=n>probabilities_looped</span> <span class=o>=</span> <span class=n>restructure_probabilities</span><span class=p>[:,</span> <span class=n>permutations</span><span class=p>[</span><span class=nb>iter</span><span class=p>,:]]</span>
  <span class=c1># Markov multiplication</span>
  <span class=n>results_lopped</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>matmul</span><span class=p>(</span><span class=n>probabilities_looped</span><span class=p>,</span> <span class=n>assets_value_debt</span><span class=p>)</span>
  <span class=c1># difference between partnership states</span>
  <span class=n>final_differences</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>results_lopped</span> <span class=o>-</span> <span class=n>previous_stake</span><span class=p>)</span>
  <span class=n>results</span><span class=p>[</span><span class=nb>iter</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>final_differences</span><span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=n>results</span><span class=p>))</span> <span class=c1># the optimal restructuring difference</span>
<span class=nb>print</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>argmin</span><span class=p>(</span><span class=n>results</span><span class=p>))</span>
<span class=n>end</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Runtime of the program is </span><span class=si>{</span><span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></code></pre></td></tr></table>
</div>
</div>
<hr>
</div>
</div><html>
<body>
<div id=footer class=mb-5>
<hr>
<div class="container text-center">
<a href=https://daniel-furman.github.io/><small>By Daniel Furman</small></a>
</div>
</div>
</body>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css integrity=sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.js integrity=sha384-483A6DwYfKeDa0Q52fJmxFXkcPCFfnXMoXblOkJ4JcA8zATN6Tm78UNL72AKk+0O crossorigin=anonymous></script>
</html>
</body>
</html>